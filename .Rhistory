####Setup#####
list.of.packages <- c("grid","ggplot2")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
load("C:/git/IATI-Covid/output/agg_oda (1).RData")
#agg_oda <- fread("C:/git/IATI-Covid/output/oda_filter.csv")
# agg_oda <- fread("oda_filter.csv")
load("C:/git/IATI-Covid/agg_oda1.RData")
unique(agg_oda$reporting_org_secondary_reporter)
unique(agg_oda$x_country_code)
#agg_oda <- fread("C:/git/IATI-Covid/output/oda_filter.csv")
# agg_oda <- fread("oda_filter.csv")
hold <- read.csv("C:/git/IATI-Covid/Nigeria DFA")
#agg_oda <- fread("C:/git/IATI-Covid/output/oda_filter.csv")
# agg_oda <- fread("oda_filter.csv")
hold <- read.csv("C:/git/IATI-Covid/Nigeria DFA.csv")
#agg_oda <- fread("C:/git/IATI-Covid/output/oda_filter.csv")
# agg_oda <- fread("oda_filter.csv")
holdnew <- read.csv("C:/git/IATI-Covid/Nigeria DFA.csv")
View(holdnew)
holdnew = subset(holdnew, reporting_org_secondary_reporter %in% c("0","false"))
names(holdnew)
holdnew = subset(holdnew, 'Reporting.Organisation.Secondary.Reporter' %in% c("0","false"))
holdnew <- read.csv("C:/git/IATI-Covid/Nigeria DFA.csv")
holdnew = subset(holdnew, 'Reporting.Organisation.Secondary.Reporter' %in% c("0","false"))
holdnew$Reporting.Organisation.Secondary.Reporter
#agg_oda <- fread("C:/git/IATI-Covid/output/oda_filter.csv")
# agg_oda <- fread("oda_filter.csv")
holdnew <- read.csv("C:/git/IATI-Covid/Nigeria DFA.csv")
holdnew$Reporting.Organisation.Secondary.Reporter
unique(holdnew$Reporting.Organisation.Secondary.Reporter)
holdnew = subset(holdnew, 'Reporting.Organisation.Secondary.Reporter' %in% c("0","false"))
holdnew <- read.csv("C:/git/IATI-Covid/Nigeria DFA.csv")
holdnew = subset(holdnew, 'Reporting.Organisation.Secondary.Reporter' == 0)
holdnew = subset(holdnew, holdnew$Reporting.Organisation.Secondary.Reporter == 0)
holdnew <- read.csv("C:/git/IATI-Covid/Nigeria DFA.csv")
holdnew = subset(holdnew, holdnew$Reporting.Organisation.Secondary.Reporter == 0)
holdnew = subset(holdnew, holdnew$Transaction.Type.Code %in% c("E", "D", "3", "4"))
View(holdnew)
unique(holdnew$Default.Vocabulary...Calculated)
names(holdnew)
hold <- holdnew[,.(total=abs(sum(Sector.Percentage...Calculated,na.rm=T)-100)),by=.(ï..IATI.Identifier,Transaction.Number...Calculated,Sector.Vocabulary...Calculated)]
hold <- holdnew[,.(total=abs(sum('Sector.Percentage...Calculated',na.rm=T)-100)),by=.('ï..IATI.Identifier,Transaction.Number...Calculated','Sector.Vocabulary...Calculated')]
holdnew=data.table(holdnew)
#Code to produce graphs needed for the live IATI COVID tracker page#
list.of.packages <- c("data.table", "anytime", "ggplot2", "scales", "bsts", "dplyr", "Hmisc","reshape2","splitstackshape","Cairo","svglite","extrafont","jsonlite","countrycode","xlsx")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
holdnew=data.table(holdnew)
hold <- holdnew[,.(total=abs(sum('Sector.Percentage...Calculated',na.rm=T)-100)),by=.('ï..IATI.Identifier,Transaction.Number...Calculated','Sector.Vocabulary...Calculated')]
hold <- holdnew[,.(total=abs(sum(Sector.Percentage...Calculated,na.rm=T)-100)),by=.(ï..IATI.Identifier,Transaction.Number...Calculated,Sector.Vocabulary...Calculated)]
hold= hold[,.(ranking=rank(total,ties.method="first"),Sector.Vocabulary...Calculated,total),by=.(ï..IATI.Identifier,Transaction.Number...Calculated)]
hold <- hold[,.(minimum_rank=min(ranking),ranking,Sector.Vocabulary...Calculated),by=.(ï..IATI.Identifier,Transaction.Number...Calculated)]
t.merged <- merge(hold,holdnew,by = c("ï..IATI.Identifier","Transaction.Number...Calculated","Sector.Vocabulary...Calculated"),all.y=T)
holdnew = subset(t.merged,ranking==minimum_rank)
View(holdnew)
holdnew = subset(holdnew,holdnew$Transaction.Value.USD...Calculated>0)
yeardata <- holdnew[,.(monthly_totals=sum(Transaction.Value.USD...Calculated)),by=.(YYYYMM.year.and.month)]
View(yeardata)
holdnew <- fread("https://ddw.devinit.org/queries/data/647")
wd = "C:/git/aid-tracker-interactive/"
setwd(wd)
read.csv("overall_oda_oof.csv")
wd = "C:/git/aid-tracker-interactive/"
setwd(wd)
data <- read.csv("overall_oda_oof.csv")
data <- melt(data,id.vars=c("year","org_type","transaction_type","indicator","variable"))
write.csv(data,"overall_oda_oof_wide.csv")
list.of.packages <- c("data.table", "anytime", "ggplot2", "scales", "bsts", "dplyr", "plyr","Hmisc","reshape2","splitstackshape","Cairo","svglite","extrafont","jsonlite","countrycode","openxlsx","english","stringr","tidyr")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
wd = "C:/git/aid-tracker-interactive/"
setwd(wd)
data <- read.csv("overall_oda_oof.csv")
data <- melt(data,id.vars=c("year","org_type","transaction_type","indicator","variable"))
write.csv(data,"overall_oda_oof_wide.csv")
list.of.packages <- c("data.table", "anytime", "ggplot2", "scales", "bsts", "dplyr", "plyr","Hmisc","reshape2","splitstackshape","Cairo","svglite","extrafont","jsonlite","countrycode","openxlsx","english","stringr","tidyr")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
wd = "C:/git/aid-tracker-interactive/"
setwd(wd)
data <- read.csv("overall_oda_oof.csv")
data <- dcast(data,year+org_type+transaction_type+indicator+variable ~ flow_type)
write.csv(data,"overall_oda_oof_wide.csv")
